SerialEMProperties
GainReferencePath	C:\ProgramData\SerialEM\
MRCHeaderTitle	Acquired on UMass Talos Camera -> 0:Ceta 1:K3
LogBookPathName	C:\ProgramData\SerialEM\TiltSeriesLogBook.txt
DigitalMicrographReferencePath	C:\ProgramData\Gatan\Reference Images

StartUpMessage Talos Admin - IS!
ProgramTitleText	[ Talos Arctica ]
DisplayIsNot120DPI	1
## https://www.sven.de/dpi/ -> 31.5 inch @ 2560x1600 
## full 3840x2160 @ 31.5 inch -> 139.89 DPI
AssumeDPI		 144	#161	# for 2560x1440 @100%	
DebugOutput              0

## Python Support (Apr 30, 2021)
PythonModulePath C:\Program Files\SerialEM\PythonModules
#PathToPython 3.9 C:\Users\VALUEDGATANCUSTOMER\AppData\Local\Programs\Python\Python39
PathToPython 3.9 C:\Users\VALUEDGATANCUSTOMER\miniconda3\
EnableExternalPython	1
ScriptMonospaceFont	Consolas

#
#  GENERAL CAMERA PROPERTIES
#
ActiveCameraList		0 1
OtherCamerasInTIA		1
InitialCurrentCamera		1
AssumeCameraForDummy		1

GainNormalizeInSerialEM		0
ReferenceMemoryLimitMB		160
DarkRefAgeLimit			3600
GainRefInactivityLimit		180
DefaultCameraDivide16BitBy2     0
DefaultActAfterExposures	0
StartCameraInDebugMode		0

InnerXRayBorderDistance		1.2
OuterXRayBorderDistance 	2.1
XRayCriterionIterations		4
XRayCriterionIncrease		1.0

BiggestGIFApertureNumber	4
FilterSlitInOutDelay		18
FilterOffsetDelayCriterion	40.
FilterOffsetDelayBase1		10.
FilterOffsetDelayBase2		30.
FilterOffsetDelaySlope1		0.5
FilterOffsetDelaySlope2		0.25
RetractCameraOnEnteringEFTEM	0
MinLowMagSlitWidth		25
SlitWideningSafetyFactor	0.75
EnergyShiftCalMinField		8.
RefineZLPStepSize		2.
RefineZLPSlitWidth		20.
RefineZLPMinimumExposure	0.005

#   CETA PROPERTIES
#
CameraProperties        0
# You can add "DetectorName 0 official-name" and then make the Name different
# It will not work without the right name
# The name changed to BM-Eagle in Tecnai 4.1, and BM-Falcon, and BM-Ceta
# The 2K Eagle and the Falcon do not have binning 8
# For Falcon, set FEICameraType to 2, pixel size to 14, remove RelativeGainFactors
# For Ceta, set FEICameraType to 3, pixel size to 14, remove RelativeGainFactors
# You can add "DetectorName 0 official-name" and then make the Name different
Name    			BM-Ceta
FEICameraType 			3
CameraSizeX     		4096
CameraSizeY     		4096
RotationAndFlip              	1
MakesUnsignedImages		1
FourPortReadout         	1
Binnings        		1 2 4 8
#UsableArea 			7 7 4087 4085
HotPixelsAreImodCoords  	1
#DarkXRayAbsoluteCriterion	20
#DarkXRaySDCriterion		15
#DarkXRayRequireBothCriteria	1
MaximumXRayDiameter     	6
BuiltInSettling 		0
ExtraBeamTime   		0.05
StartupDelay    		1.
ShutterDeadTime			0.007
Retractable     		0
GIF     			0
Order 				1
FilmToCameraMagnification       1.28
PixelSizeInMicrons      	14
CountsPerElectron	        6.90
ExtraRotation   0.
# MagIndex  DeltaRotation (999 not measured)  SolvedRotation (999 not measured)   Pixel size (nm, 0 not measured)
#RotationAndPixel 22 999 999 0.997
RotationAndPixel 6 999 -4.9 0 		#115X
RotationAndPixel 8 999 -5.3 0 		#210X
RotationAndPixel 16 999 -95.4 6.27
RotationAndPixel 17 999 -179.9 11.82
RotationAndPixel 18 999 -197.4 0
RotationAndPixel 20 999 999 5.656

EndCameraProperties

# K2 PROPERTIES
# These are properties assuming remote access and a 270-degree rotation and
#  flip, which seems standard for Tecnai/Polara above-GIF installs

GatanServerIP 127.0.0.1
#GatanServerIP 172.18.8.141
GatanServerPort 48890 
SocketServerIP 1 172.18.8.16
SocketServerPort 1 48892

#
K2FilterName Hanning Window (default)
K2FilterName Bandpass Filter (default)
K2FilterName Sobel Filter (default)
K2FilterName Combined Filter (default)

#######################################
CameraProperties	     1
Name	                     Talos-K3
K2Type	                     3
#DMGainReferenceName	     K3-18140113 Gain Ref. x1.m0.dm4
#DMGainReferenceName	     K3-18140113 Gain Ref. x1.m0.kv[200].dm4
DMGainReferenceName	     K3-18290179 Gain Ref. x1.m0.dm4
# THESE 5 WILL NEED CHANGING IF CAMERA ORIENTATION CHANGES
CameraSizeX	             5760
CameraSizeY	             4092
SizeCheckSwapped             1
RotationAndFlip              0		# accedently 1 before
DMRotationAndFlip            0
#UsableArea                  0 0 3712 3840 	# top left bottom right!
UseSocket	             0
MakesUnsignedImages	     1
XMustBeMultipleOf	     4
YMustBeMultipleOf	     2
FourPortReadout	             0
Binnings	             1 2 3 4 6 8
BasicCorrections	     49
HotPixelsAreImodCoords	     1
#DarkXRayAbsoluteCriterion   20
#DarkXRaySDCriterion	     15
#DarkXRayRequireBothCriteria 1
MaximumXRayDiameter	     6
BeamBlankShutter	     0
OnlyOneShutter	             1
StartupDelay                 1.185		#??????
ExtraBeamTime                0.10
BuiltInSettling              0.0 
ShutterDeadTime	             0.00		
MinimumDriftSettling	     0.05
MinimumBlankedExposure       0.35
ExtraUnblankTime	     0.012
ExtraOpenShutterTime	     0.12
Retractable	             1
InsertionDelay	             5.0
RetractionDelay	             3.0
GIF	                     0
Order                        2
FilmToCameraMagnification    1.31	# orig=1.342
PixelSizeInMicrons	     5.0  
#CountsPerElectron	     #37.55	not needed for K3 # measured at 3.15 e/p/s
#LinearToCountingRatio	     207	# according to Mast
ExtraRotation	             0.
AllowPostActions	     0
# MagIndex  DeltaRotation (999 not measured)  SolvedRotation (999 not measured)   Pixel size (nm, 0 not measured)
##RotationAndPixel 33 0.04 999 0.0749
#RotationAndPixel 1 999 -3.9 0
#RotationAndPixel 4 999 -102.4 0
RotationAndPixel 2 999 -94.0 0     #K3 34x
RotationAndPixel 3 999 -94.4 0
#RotationAndPixel 16 999 -4.9 1.797
RotationAndPixel 16 999 -94.4 1.74	#k2=1.797
#RotationAndPixel 17 999 90.9 3.291	#k2=3.396
## Redo pixelsize by Chen @ 9/29/2022
RotationAndPixel 17   999    90.9  3.317   # 1250, p=4147
RotationAndPixel 18    0.22  999   2.602   # 1600, p=4164
RotationAndPixel 19   -0.29  999   2.006   # 2000, p=4012
RotationAndPixel 20   -1.29  999   1.571   # 2600, p=4084
RotationAndPixel 21   -0.25  999    1.22   # 3400, p=4149
RotationAndPixel 22    0.08  999   0.954   # 4300, p=4102
#today
RotationAndPixel 24    999   999  0.6203   # 6700, p=4156
RotationAndPixel 25    0.02  999  0.4912   # 8500, p=4176
RotationAndPixel 26    0.58  999  0.3799   # 11000, p=4179
RotationAndPixel 27   -0.05  999  0.2992   # 13500, p=4039
RotationAndPixel 28   -0.58  999  0.2383   # 17500, p=4170
RotationAndPixel 29    3.37  999  0.1849   # 22000, p=4069
RotationAndPixel 30   -0.11  999  0.1456   # 28000, p=4077
RotationAndPixel 31   -0.09  999  0.1141   # 36000, p=4108
#RotationAndPixel 32   -0.06  999  0.09005   # 45000, p=4052
RotationAndPixel 32   -0.06  999 0.087	# from KK's pixel refine
RotationAndPixel 33    0.02  999 0.07141   # 57000, p=4071


## K3
LinearToCountingRatio	328

## CDS
K3CDSLinearRatio	1.37
EndCameraProperties

################################################
# For Rio camera, set type to 2, set size if different, set pixel size to 9
#
CameraProperties 			2
Name    				Rio16
DMGainReferenceName			Rio1816-C17106F0-0011 Gain Ref. x1.m0.roi[0,0,4096,4096].dm4
OneViewType				2
CameraSizeX     			4096
CameraSizeY     			4096
DMRotationAndFlip            		4
RotationAndFlip				4
MakesUnsignedImages			1
XMustBeMultipleOf       		4
YMustBeMultipleOf      			4
# BINNING 8  IS NOT SUPPORTED: IF IT WORKS OK, FINE; IF NOT, TAKE IT OUT
Binnings        			1 2 4 8
BasicCorrections                        49
#UsableArea 				7 7 4089 4089
HotPixelsAreImodCoords  		1
#DarkXRayAbsoluteCriterion	20
#DarkXRaySDCriterion		15
#DarkXRayRequireBothCriteria	1
MaximumXRayDiameter     	6	
MinimumDriftSettling   			0.04
FourPortReadout				0
ShutterDeadTime	             		0.00		
StartupDelay  				0.175 
ExtraBeamTime  				0.20
BuiltInSettling  			0.0
Retractable     			1
BeamBlankShutter			0
# TRY THIS: EVEN IF THERE ARE TWO SHUTTERS, IT WILL WORK BETTER IF YOU USE ONE
OnlyOneShutter				1
Order 					0
PixelSizeInMicrons			9.0
FilmToCameraMagnification       	1.362
ExtraRotation   			0.
CountsPerElectron			108    # 80.16 need to verify
#DMRotationAndFlip			4
InsertionDelay				10
RetractionDelay				10
CanTakeFrames				3
# THESE MAY OR MAY NOT BE NEEDED
#RelativeGainFactors			1 0.25 0.125 0.0625
#
# MagIndex  DeltaRotation (999 not measured)  SolvedRotation (999 not measured)   Pixel size (nm, 0 not measured)
#RotationAndPixel 20    0.16  999     0.77
RotationAndPixel 17	999	86.7  5.853
RotationAndPixel 16	999	999   3.094
EndCameraProperties


# THIS NEEDS TO HAVE GIF MAGS ADDED

# Mag table:  Index  TecnaiFilmMag  TecnaiRotation  - both reported by scope (Add screen mag by hand)
# If there is a GIF, add EFTEM screen up mag, reported rotation, screen down mag
MagnificationTable  44 
1       25   -90
2       34   -90
3       46   -90
4       62   -90
5       84   -90
6      115   -90
7      155   -90
8      210   -90
9      280   -90
10      380   -90
11      510   -90
12      700   -90
13      940   -90
14     1300   -90
15     1700   -90
16     2300   -90
17     1250    90
18     1600    90
19     2000    90
20     2600    90
21     3400    90
22     4300    90
23     5300    90
24     6700    90
25     8500    90
26    11000    90
27    13500    90
28    17500    90
29    22000    90
30    28000    90
31    36000    90
32    45000    90
33    57000    90
34    73000    90
35    92000    90
36   120000    90
37   150000    90
38   190000    90
39   240000    90
40   310000    90
41   390000    90
42   400000    90
43   510000    90
44   650000    90

## add CameraLength Table
CameraLengthTable  49
1 23
2 31
3 44
4 57
5 76
6 97
7 125
8 160
9 200
10 260
11 330
12 420
13 530 9000
14 670
15 850
16 1050
17 1350
18 1750
19 2200
20 2800
21 3600
22 4500
23 5700
24 7200
25 9200
32 5900
33 7400
34 9500
35 12000
36 15500
37 19500
38 24500
39 31000
40 40000
41 50000
42 63000
43 81000
44 100000
45 130000
46 165000
47 210000
48 270000
49 340000
50 430000
51 550000
52 700000
53 880000
54 1100000
55 1400000
NumberOfCameraLengths 25 24


#
# SCOPE PROPERTIES
#
LowestMModeMagIndex             17
GlobalExtraRotation		-5   # INITIALLY SET TO -12 FOR 300 KV, -5 FOR 200
MicronsPerUnitImageShift	1.
DeltaZtoDefocusFactor	        1.0
ScreenCurrentFactor             1.0

SmallScreenFactor		1.0
LensNormalizationDelay		2000

#
# For Titan or Tecnai 4.0 this needs to be the name of the gauge in TUI,
# IGPCl for Titan or IGP1 for Tecnai or IGPco for Talos
WatchGauge			IGPco 1.48e-5 4.25e-5
FloatingCurrentMeterSmoothed	0
MaxCalibrationImageShift	5.
MaxLMCalibrationImageShift	15.
StageLimits			0. 0. 0. 0.     # SET LIMITS IF NEEDED FOR Setup Full Montage


ImageShiftDelays 		7
0.1 0.
0.3 0.4
0.8 0.9
1.6 1.7
3. 3.
3.5 3.5
4. 3.7

ImageShiftLimit 25

#
# FILE OPTIONS
#
FileOptionsMode			1
FileOptionsExtraFlags		17
FileOptionsMaxSections		360
FileOptionsPixelsTruncatedLo	40
FileOptionsPixelsTruncatedHi	40
FileOptionsUnsignedOption	0

# 
# TASK MINUMUM FIELD SIZES AND OTHER PROPERTIES
#
ResetRealignMinField	        8.
ReverseTiltMinField	        4.5
WalkUpMinField	                1.5
EucentricityCoarseMinField	8.
EucentricityFineMinField	4.5
EucentricityFineAlignMinField	8.
ResetRealignMaxIterations	2
ResetRealignHigherMagCriterion	0.5
WalkUpShiftLimit	        3.0     # SET TO 2.0 for 300 KV TECNAI/POLARA
WalkUpLowDoseISLimit	        2.0     # SET TO 1.3 for 300 KV TECNAI/POLARA
EucentricityBacklashZ	        -3.
EucentricityResetISThreshold	0.1
EucentricityMaxFineIS	        3.      # SET TO 2.0 for 300 KV TECNAI/POLARA
TiltBacklash	                3.
CheckAutofocusChange	        5.
TSDefaultStartAngle	        60.
TSMaxTiltError	                0.1

#
# INTENSITY CALIBRATION
#
BeamCalMinField             	8.
BeamCalExtraRangeNeeded	    	10.
BeamCalChangeDelay	    	1000 
BeamCalMinExposure	    	0.1
BeamCalMaxExposure	    	3.
BeamCalMinCounts	    	100
BeamCalMaxCounts	    	8000
BeamCalInitialIncrement	    	0.0001
BeamCalSpacingFactor	    	1.1

################## added by Chen
# USE THESE FOR CALIBRATING ON CETA
#BeamCalMaxExposure		3.
#BeamCalMinCounts		3000
#BeamCalFavorMagChanges  	1

# USE THESE FOR CALIBRATING ON K2
#BeamCalMaxExposure 		0.4
#BeamCalMinCounts 		10000

# testing on Talos for 46x - to allow Realign in LM range
RealignItemMaxLMField		700 #360	#46x
NavigatorMaxMontageIS		50
		
# email alert setup
SMTPServer	smtp.gmail.com
SendMailFrom	Talos-K2@cryoem.umassmed.edu

## try out to press COM error - actually the hiccups to acquire

#CameraRetries 		3
MakeFEIerrorBeTimeout	1

# added for 16bit map display by Chen & KH @12/03/2018
ConvertMapsToBytesDefault	0

## speed up MMM, within the limit, no stage move, which could save a second or two. Chen@march_24_2019
#NavigatorMaxMontageIS	50
RealignItemMaxIS	2

## for background tilting
BackgroundSocketToFEI	1

## debug for Eagle and Ceta (FEI camera)
#DebugOutput		E

## add some tools
ExternalTool Open Mdoc File
ToolCommand 1 notepad
ToolArguments 1 %imagefile%.mdoc
ExternalTool Open Nav File
ToolCommand 2 notepad
ToolArguments 2 %navfile%
ExternalTool 3dmod Image File
ToolCommand 3 C:\Program Files\3dmod\3dmod
ToolArguments 3 %imagefile%
ExternalTool VIM Nav File
ToolCommand 4 C:\Program Files (x86)\Vim\vim82\gvim
ToolArguments 4 %navfile%

## for Z by G non-reciprocity
ZbyGFocusScalings  0  0.91  -50  0.932  -100  0.942  -150  0.932  -200  0.957  -250  0.943  -300  0.915

## added April 2, 2022
DewarVacCapabilities	3

## debug IS non-consistant issue for low and high mag
OtherShiftBoundaries 18,19,20,23